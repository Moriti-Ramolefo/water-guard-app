<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Gaurd Inc. - History</title>
    <link rel="stylesheet" href="../static/css/history.css">
    <link rel="icon" href="../static/images/mp/icon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script|Poppins&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="//unpkg.com/alpinejs" defer></script>

</head>

<body>

    <!-- watermark -->

    <img src="../static/images/watermark-logo.png" class="watermark-img" alt="">

    <!-- top buttons -->

    <div x-data="myAPI">
        <div class="header-history">
            <div class="history">
                <h1>History</h1>
            </div>
            <div class="back">
                <strong><a href="/main"> Back</a>
            </div>
        </div>

        <!-- filter starts here -->

        <div class="container d-flex justify-content-end">
            <div class="row ">
                <div class="col-md-6">
                    <div class="form-outline">
                        <input type="text" id="filter" class="form-control" x-model="limit" placeholder="Number of Rows"
                            style="background: rgba(255, 255, 255, 0.5); border: none; color: #fff; transition: .5s;">
                    </div>
                </div>
                <div class="col-md-6">
                    <button type="button" x-on:click="filterTable(), DataTable = false, filterTable = true"
                        class="btn btn-primary" style="background: rgba(255, 255, 255, 0.5); border: none;
                        color: #fff; transition: .5s;"><strong> Filter</button>
                </div>
            </div>
        </div>

        <!-- filter ends here -->

        <div x-show="DataTable">
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Ph</th>
                        <th scope="col">Temperature</th>
                        <th scope="col">Turbidity</th>
                        <th scope="col">Hardness</th>
                        <th scope="col">Day</th>
                        <th scope="col">Time</th>
                        <th scope="col">Flow rate</th>
                        <th scope="col">Water pressure</th>
                        <th scope="col">Leak</th>
                        <th scope="col">Quality</th>
                        <th scope="col">Created_At</th>
                    </tr>
                </thead>

                <!--   showing the prediction values and the predicted results  -->

                <template x-for="data in dataset">
                    <tbody>
                        <tr>
                            <th scope="row" x-text="data.id"></th>
                            <td x-text="data.ph"></td>
                            <td x-text="data.temperature"></td>
                            <td x-text="data.turbidity"></td>
                            <td x-text="data.hardness"></td>
                            <td x-text="data.day_of_week"></td>
                            <td x-text="data.time"></td>
                            <td x-text="data.flow_rate"></td>
                            <td x-text="data.water_pressure"></td>
                            <td x-text="data.leak_detector"></td>
                            <td x-text="data.quality_detector"></td>
                            <td x-text="data.created_at"></td>
                        </tr>
                    </tbody>
                </template>
            </table>
        </div>

        <!-- Filteriing the data -->

        <div x-show="filterTable">
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Ph</th>
                        <th scope="col">Temperature</th>
                        <th scope="col">Turbidity</th>
                        <th scope="col">Hardness</th>
                        <th scope="col">Day</th>
                        <th scope="col">Time</th>
                        <th scope="col">Flow rate</th>
                        <th scope="col">Water pressure</th>
                        <th scope="col">Leak</th>
                        <th scope="col">Quality</th>
                        <th scope="col">Created_At</th>
                    </tr>
                </thead>
                <!--   showing the prediction values and the predicted results  -->

                <template x-for="filterData in filterDatas">
                    <tbody>
                        <tr>
                            <th scope="row" x-text="filterData.id"></th>
                            <td x-text="filterData.ph"></td>
                            <td x-text="filterData.temperature"></td>
                            <td x-text="filterData.turbidity"></td>
                            <td x-text="filterData.hardness"></td>
                            <td x-text="filterData.day_of_week"></td>
                            <td x-text="filterData.time"></td>
                            <td x-text="filterData.flow_rate"></td>
                            <td x-text="filterData.water_pressure"></td>
                            <td x-text="filterData.leak_detector"></td>
                            <td x-text="filterData.quality_detector"></td>
                            <td x-text="filterData.created_at"></td>
                        </tr>
                    </tbody>
                </template>
            </table>
        </div>
    </div>

    <script>

        document.addEventListener('alpine:init', () => {
            Alpine.data('myAPI', function () {
                return {

                    filterTable: false,
                    DataTable: true,

                    init() {

                        const url = `https://water-monitor-database.herokuapp.com/api/pipeline_dataset/history`;
                        axios
                            .get(url)
                            .then((result) => {

                                // console.log(result.data.history_dataset),
                                this.dataset = result.data.history_dataset;
                            })
                    },

                    filterTable() {

                        const url = `https://water-monitor-database.herokuapp.com/api/pipeline_dataset/history/selection?selectNum=${this.limit}`;

                        axios
                            .get(url)
                            .then((result) => {

                                console.log(result.data.history_dataset),
                                    this.filterDatas = result.data.selectedRes;
                            })
                    },


                    dataset: [],
                    filterDatas: [],
                    limit: '',
                }
            })
        })

    </script>

</body>

</html>